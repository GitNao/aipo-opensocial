<?xml version="1.0" encoding="UTF-8"?>
<Module>
  <ModulePrefs title="OSAPI Groups Sample">
    <Require feature="opensocial-1.0" />
    <Require feature="osapi" />
    <Require feature="dynamic-height"/>  
  </ModulePrefs>
  <Content type="html">
   <![CDATA[
   
<h1>OSAPI Groups Sample</h1>
<div id="result"></div>
<div id="resultPeople"></div>

<script type="text/javascript">

  gadgets.util.registerOnLoadHandler(init);

  function setResult(groups) {
    html = new Array();
    html.push('<ul>');
      
    var size = groups.list.length;
    for (var i = 0; i < size; i++) {
      html.push('<li>');
      html.push('<a href="javascript:void(0);" onclick="executePeople(\'' + groups.list[i].id.groupId + '\',0);">');
      html.push(groups.list[i].id.groupId + " : " + groups.list[i].title + "</a></li>");
    };
    
    html.push('</ul>');
    var totalResults = groups.totalResults;
    var startIndex = groups.startIndex;
    var page = Math.ceil(totalResults / 10);
    for (var i = 0; i < page; i++) {
      var next = i * 10;
       html.push('<a href="javascript:void(0);" onclick="execute(' + next + ');">');
       html.push(i+1);
       html.push('</a>&nbsp;');
      
    }
    document.getElementById('result').innerHTML = html.join('');
    
    gadgets.window.adjustHeight(); 
  
  }
  
  function setResultPeople(people) {
    html = new Array();
    html.push('<ul>');
      
    var size = people.list.length;
    for (var i = 0; i < size; i++) {
      html.push('<li>' + people.list[i].id + ":" + people.list[i].displayName + "</li>");
    };
    
    html.push('</ul>');
    var totalResults = people.totalResults;
    var startIndex = people.startIndex;
    var page = Math.ceil(totalResults / 5);
    for (var i = 0; i < page; i++) {
       var next = i * 5;
       html.push('<a href="javascript:void(0);" onclick="executePeople(\'' + currentGroupId + '\',' + next +');">');
       html.push(i+1);
       html.push('</a>&nbsp;');
      
    }
    document.getElementById('resultPeople').innerHTML = html.join('');
    
    gadgets.window.adjustHeight(); 
  }
  
  function loadPeople(response) {
    gadgets.log(response);
      
    var people = response.people;
    setResultPeople(people);
  }
  
  function load(response) {
    gadgets.log(response);
      
    var groups = response.groups;
    setResult(groups);
  }
  
  function execute(startIndex) {
    var batch = osapi.newBatch()
      .add('groups', osapi.groups.get({ userId: '@owner', startIndex: startIndex, count: 10 }));

    batch.execute(load);
  }
  
  var currentGroupId;
  function executePeople(groupId, startIndex) {
    var batch = osapi.newBatch()
      .add('people', osapi.people.get({ userId: '@owner', groupId: groupId, startIndex: startIndex, count: 5 }));
    batch.execute(loadPeople);
    currentGroupId = groupId;
  }
  
  function init() {
    execute(0);
  }
  
</script>


  ]]>
  </Content>
</Module>